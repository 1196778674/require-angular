define(["require","exports","module"],function(a,b,c){var d=function(){var a=[].slice.call(arguments);return a.push(d.options),1==arguments.length?d.compile.apply(d,a):arguments.length>=2?d.to_html.apply(d,a):void 0},e={escapehash:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#x27;","/":"&#x2f;"},escapereplace:function(a){return e.escapehash[a]},escaping:function(a){return"string"!=typeof a?a:a.replace(/[&<>"]/gim,this.escapereplace)},detection:function(a){return"undefined"==typeof a?"":a}},f=function(a){if(console){if(console.warn)return void console.warn(a);if(console.log)return void console.log(a)}throw a},g=function(a,b){if(a=a!==Object(a)?{}:a,a.__proto__)return a.__proto__=b,a;var c=function(){},d=new(c.prototype=b,c);for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e]);return d};d.__cache={},d.version="0.4.0-dev",d.settings={forstart:/{@each\s*([\w\.]*?)\s*as\s*(\w*?)\s*(,\s*\w*?)?}/gim,forend:/{@\/each}/gim,ifstart:/{@if\s*([^}]*?)}/gim,ifend:/{@\/if}/gim,elsestart:/{@else}/gim,elseifstart:/{@else if\s*([^}]*?)}/gim,interpolate:/\${([\s\S]+?)}/gim,noneencode:/\$\${([\s\S]+?)}/gim,inlinecomment:/{#[^}]*?}/gim,rangestart:/{@each\s*(\w*?)\s*in\s*range\((\d+?),(\d+?)\)}/gim},d.options={cache:!0,strip:!0,errorhandling:!0,detection:!0,_method:g({__escapehtml:e,__throw:f},this)},d.set=function(a,b){if(2===arguments.length)return void(this.options[a]=b);if(a===Object(a))for(var c in a)a.hasOwnProperty(c)&&(this.options[c]=a[c])},d.register=function(a,b){var c=this.options._method;return!c.hasOwnProperty(a)&&(c[a]=b)},d.unregister=function(a){var b=this.options._method;return b.hasOwnProperty(a)?delete b[a]:void 0},d.template=function(a){var b=this;this.options=a,this.__interpolate=function(a,b,c){var d=a.split("|"),e="";return d.length>1&&(a=d.shift(),e="_method."+d.shift()),"<%= "+(b?"_method.__escapehtml.escaping":"")+"("+(c&&c.detection===!1?"":"_method.__escapehtml.detection")+"("+e+"("+a+"))) %>"},this.__removeShell=function(a,c){var e=0;return a=a.replace(d.settings.forstart,function(a,b,c,d){var c=c||"value",d=d&&d.substr(1),f="i"+e++;return"<% for(var "+f+"=0, l"+f+"="+b+".length;"+f+"<l"+f+";"+f+"++) {var "+c+"="+b+"["+f+"];"+(d?"var "+d+"="+f+";":"")+" %>"}).replace(d.settings.forend,"<% } %>").replace(d.settings.ifstart,function(a,b){return"<% if("+b+") { %>"}).replace(d.settings.ifend,"<% } %>").replace(d.settings.elsestart,function(a){return"<% } else { %>"}).replace(d.settings.elseifstart,function(a,b){return"<% } else if("+b+") { %>"}).replace(d.settings.noneencode,function(a,d){return b.__interpolate(d,!1,c)}).replace(d.settings.interpolate,function(a,d){return b.__interpolate(d,!0,c)}).replace(d.settings.inlinecomment,"").replace(d.settings.rangestart,function(a,b,c,d){var f="j"+e++;return"<% for(var "+f+"=0;"+f+"<"+(d-c)+";"+f+"++) {var "+b+"="+f+"; %>"}),c&&c.errorhandling===!1||(a="<% try { %>"+a,a+='<% } catch(e) {_method.__throw("Juicer Render Exception: "+e.message);} %>'),a},this.__toNative=function(a,b){return this.__convert(a,!b||b.strip)},this.__lexicalAnalyze=function(a){var b=[],c="",e=function(a,b){if(Array.prototype.indexOf&&a.indexOf===Array.prototype.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},f=function(a,c){c=c.match(/\w+/gim)[0],-1===e(b,c)&&b.push(c)};a.replace(d.settings.forstart,f).replace(d.settings.interpolate,f).replace(d.settings.ifstart,f);for(var g=0;g<b.length;g++)c+="var "+b[g]+"=_."+b[g]+";";return"<% "+c+" %>"},this.__convert=function(a,b){var c=[].join("");return c+="'use strict';",c+="var _=_||{};",c+="var _out='';_out+='",c+=b!==!1?a.replace(/\\/g,"\\\\").replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out;":a.replace(/\\/g,"\\\\").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\n]/g,"\\n").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"';_out+=$1;_out+='").split("<%").join("';").split("%>").join("_out+='")+"';return _out.replace(/[\\r\\n]\\s+[\\r\\n]/g, '\\r\\n');"},this.parse=function(a,c){var d=this;return c&&c.loose===!1||(a=this.__lexicalAnalyze(a)+a),a=this.__removeShell(a,c),a=this.__toNative(a,c),this._render=new Function("_, _method",a),this.render=function(a,c){return c&&c===b.options._method||(c=g(c,b.options._method)),d._render.call(this,a,c)},this}},d.compile=function(a,b){b&&b===this.options||(b=g(b,this.options));try{var c=this.__cache[a]?this.__cache[a]:new this.template(this.options).parse(a,b);return b&&b.cache===!1||(this.__cache[a]=c),c}catch(a){return f("Juicer Compile Exception: "+a.message),{render:function(){}}}},d.to_html=function(a,b,c){return c&&c===this.options||(c=g(c,this.options)),this.compile(a,c).render(b,c._method)},"undefined"!=typeof b&&b.exports?b.exports=d:this.juicer=d});